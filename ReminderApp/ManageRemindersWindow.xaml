<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="clr-namespace:ReminderApp.UI"
        mc:Ignorable="d"
        x:Class="ReminderApp.UI.ManageRemindersWindow"
        d:DataContext="{d:DesignInstance Type=ui:ManageRemindersWindow}"
        xmlns:converters="clr-namespace:ReminderApp.Converters"
        Icon="/Icons/tray.ico"
        Title="Reminders"
        Height="420"
        Width="700"
        FontSize="14"
        ShowInTaskbar="True"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
        Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVis" />
        <converters:InverseBoolToVisibilityConverter x:Key="InvBoolToVis" />
        <converters:BoolToOpacityConverter x:Key="BoolToOpacity" />
        <converters:TimeSpanConverter x:Key="TimeSpanConverter" />

        <!-- Enhanced Button Style -->
        <Style TargetType="Button">
            <Setter Property="Background"
                    Value="#E8E8E8" />
            <Setter Property="Foreground"
                    Value="#333333" />
            <Setter Property="BorderThickness"
                    Value="1" />
            <Setter Property="BorderBrush"
                    Value="#D0D0D0" />
            <Setter Property="Padding"
                    Value="8,4" />
            <Setter Property="Cursor"
                    Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="5"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="border"
                                        Property="Background"
                                        Value="#D4D4D4" />
                                <Setter TargetName="border"
                                        Property="BorderBrush"
                                        Value="#A0A0A0" />
                            </Trigger>
                            <Trigger Property="IsPressed"
                                     Value="True">
                                <Setter TargetName="border"
                                        Property="Background"
                                        Value="#C0C0C0" />
                                <Setter TargetName="border"
                                        Property="BorderBrush"
                                        Value="#808080" />
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter TargetName="border"
                                        Property="Background"
                                        Value="#F0F0F0" />
                                <Setter Property="Foreground"
                                        Value="#CCCCCC" />
                                <Setter TargetName="border"
                                        Property="BorderBrush"
                                        Value="#E0E0E0" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Red Button Style (Delete Selected) -->
        <Style TargetType="Button"
               x:Key="RedButton">
            <Setter Property="Background"
                    Value="#FF4444" />
            <Setter Property="Foreground"
                    Value="White" />
            <Setter Property="BorderBrush"
                    Value="#CC0000" />
            <Setter Property="BorderThickness"
                    Value="1" />
            <Setter Property="Padding"
                    Value="8,4" />
            <Setter Property="Cursor"
                    Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="5"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="border"
                                        Property="Background"
                                        Value="#DD0000" />
                            </Trigger>
                            <Trigger Property="IsPressed"
                                     Value="True">
                                <Setter TargetName="border"
                                        Property="Background"
                                        Value="#BB0000" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Enhanced TextBox Style -->
        <Style TargetType="TextBox">
            <Setter Property="Background"
                    Value="#FFFFFF" />
            <Setter Property="Foreground"
                    Value="#333333" />
            <Setter Property="BorderBrush"
                    Value="#D0D0D0" />
            <Setter Property="BorderThickness"
                    Value="1" />
            <Setter Property="Padding"
                    Value="6,4" />
            <Setter Property="Cursor"
                    Value="IBeam" />
            <Setter Property="CaretBrush"
                    Value="#333333" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3">
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Padding="{TemplateBinding Padding}"
                                          Focusable="False"
                                          HorizontalScrollBarVisibility="Hidden"
                                          VerticalScrollBarVisibility="Hidden" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="border"
                                        Property="BorderBrush"
                                        Value="#A0A0FF" />
                            </Trigger>
                            <Trigger Property="IsFocused"
                                     Value="True">
                                <Setter TargetName="border"
                                        Property="BorderBrush"
                                        Value="#4A90E2" />
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter TargetName="border"
                                        Property="Background"
                                        Value="#F5F5F5" />
                                <Setter Property="Foreground"
                                        Value="#CCCCCC" />
                                <Setter TargetName="border"
                                        Property="BorderBrush"
                                        Value="#E0E0E0" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>


    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header Row - Update this -->
        <Border Grid.Row="0"
                BorderBrush="LightGray"
                BorderThickness="0,0,0,1"
                Padding="8"
                Height="40"
                VerticalAlignment="Center">
            <StackPanel Orientation="Horizontal"
                        VerticalAlignment="Center">
                <!-- Select All Checkbox -->
                <CheckBox Margin="6,0,12,0"
                          VerticalAlignment="Center"
                          Checked="SelectAll_Checked"
                          Unchecked="SelectAll_Unchecked"
                          ToolTip="Select All" />

                <TextBlock Text="Description"
                           Width="160"
                           Margin="0,0,8,0"
                           FontWeight="Bold"
                           TextAlignment="Center"
                           FontSize="12" />
                <TextBlock Text="Interval"
                           Width="100"
                           Margin="0,0,8,0"
                           FontWeight="Bold"
                           TextAlignment="Center"
                           FontSize="12" />
                <TextBlock Text="Next Fire"
                           Width="85"
                           Margin="0,0,8,0"
                           FontWeight="Bold"
                           TextAlignment="Center"
                           FontSize="12" />
                <TextBlock Text="Remaining"
                           Width="75"
                           Margin="0,0,8,0"
                           FontWeight="Bold"
                           TextAlignment="Center"
                           FontSize="12" />
                <TextBlock Width="110"
                           Margin="0,0,0,0" />
            </StackPanel>
        </Border>

        <!-- List View -->
        <ListView Grid.Row="1"
                  x:Name="RemindersList"
                  ItemsSource="{Binding Reminders}"
                  SelectionMode="Single"
                  SnapsToDevicePixels="True"
                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                  Background="Transparent"
                  BorderThickness="0">

            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment"
                            Value="Stretch" />
                    <Setter Property="Padding"
                            Value="0" />
                    <Setter Property="Margin"
                            Value="0" />
                    <Setter Property="BorderThickness"
                            Value="0,0,0,1" />
                    <Setter Property="BorderBrush"
                            Value="LightGray" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListViewItem">
                                <Border Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        Padding="{TemplateBinding Padding}">
                                    <GridViewRowPresenter Content="{TemplateBinding Content}"
                                                          Columns="{TemplateBinding GridView.ColumnCollection}" />
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.Resources>
                <Style TargetType="GridViewColumnHeader">
                    <Setter Property="Visibility"
                            Value="Collapsed" />
                </Style>
            </ListView.Resources>

            <ListView.View>
                <GridView ScrollViewer.CanContentScroll="True">
                    <GridViewColumn Width="700"
                                    Header="Reminders">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Border Padding="8"
                                        HorizontalAlignment="Stretch">
                                    <StackPanel Orientation="Horizontal"
                                                VerticalAlignment="Center">
                                        <CheckBox Margin="0,0,12,0"
                                                  VerticalAlignment="Center"
                                                  IsChecked="{Binding IsSelected}" />

                                        <Grid Width="160"
                                              Margin="0,0,8,0">
                                            <TextBlock Text="{Binding Reminder.Description}"
                                                       TextAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       Visibility="{Binding IsEditing, Converter={StaticResource InvBoolToVis}}" />
                                            <TextBox Text="{Binding EditDescription, UpdateSourceTrigger=PropertyChanged}"
                                                     TextAlignment="Center"
                                                     Visibility="{Binding IsEditing, Converter={StaticResource BoolToVis}}" />
                                        </Grid>

                                        <Grid Width="100"
                                              Margin="0,0,8,0">
                                            <TextBlock Text="{Binding Reminder.Interval, Converter={StaticResource TimeSpanConverter}}"
                                                       TextAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       Visibility="{Binding IsEditing, Converter={StaticResource InvBoolToVis}}" />
                                            <!-- Edit Interval -->
                                            <StackPanel Orientation="Horizontal"
                                                        HorizontalAlignment="Center"
                                                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVis}}">
                                                <TextBox Text="{Binding EditInterval.Hours, UpdateSourceTrigger=PropertyChanged}" />
                                                <TextBlock Text=":"
                                                           Margin="2,0"
                                                           VerticalAlignment="Center" />
                                                <TextBox Text="{Binding EditInterval.Minutes, UpdateSourceTrigger=PropertyChanged}" />
                                                <TextBlock Text=":"
                                                           Margin="2,0"
                                                           VerticalAlignment="Center" />
                                                <TextBox Text="{Binding EditInterval.Seconds, UpdateSourceTrigger=PropertyChanged}" />
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Text="{Binding Reminder.NextFireTime, StringFormat='{}{0:HH:mm:ss}'}"
                                                   Width="85"
                                                   Margin="0,0,8,0"
                                                   TextAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Opacity="{Binding IsEditing, Converter={StaticResource BoolToOpacity}}" />


                                        <TextBlock Text="{Binding TimeRemainingFormatted}"
                                                   Width="75"
                                                   Margin="0,0,8,0"
                                                   TextAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Opacity="{Binding IsEditing, Converter={StaticResource BoolToOpacity}}" />

                                        <!-- Fix the action buttons and spacing -->
                                        <StackPanel Orientation="Horizontal"
                                                    HorizontalAlignment="Right"
                                                    Width="130"
                                                    Margin="0,0,0,0">
                                            <!-- Edit button with proper sizing -->
                                            <Button Width="32"
                                                    Height="32"
                                                    Padding="4"
                                                    Margin="0,0,6,0"
                                                    Visibility="{Binding IsEditing, Converter={StaticResource InvBoolToVis}}"
                                                    Click="EditButton_Click"
                                                    ToolTip="Edit"
                                                    Background="Transparent">
                                                <TextBlock FontFamily="Segoe MDL2 Assets"
                                                           Text="&#xE70F;"
                                                           FontSize="16"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                            </Button>
                                            <Button Width="32"
                                                    Height="32"
                                                    Padding="4"
                                                    Margin="0,0,6,0"
                                                    Visibility="{Binding IsEditing, Converter={StaticResource InvBoolToVis}}"
                                                    Click="SkipButton_Click"
                                                    ToolTip="Skip"
                                                    Background="Transparent">
                                                <TextBlock FontFamily="Segoe MDL2 Assets"
                                                           Text="&#xE893;"
                                                           FontSize="16"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                            </Button>

                                            <!-- Save/Cancel with more space -->
                                            <StackPanel Orientation="Horizontal"
                                                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVis}}">
                                                <Button Content="Save"
                                                        Width="50"
                                                        Height="28"
                                                        Margin="0,0,4,0"
                                                        Click="SaveButton_Click"
                                                        FontSize="11"
                                                        Padding="4,2" />
                                                <Button Content="Cancel"
                                                        Width="55"
                                                        Height="28"
                                                        Click="CancelButton_Click"
                                                        FontSize="11"
                                                        Padding="4,2" />
                                            </StackPanel>

                                            <!-- Delete button -->
                                            <Button Width="32"
                                                    Height="32"
                                                    Padding="4"
                                                    Margin="6,0,0,0"
                                                    Visibility="{Binding IsEditing, Converter={StaticResource InvBoolToVis}}"
                                                    Click="DeleteButton_Click"
                                                    ToolTip="Delete"
                                                    Background="Transparent"
                                                    Foreground="Red">
                                                <TextBlock FontFamily="Segoe MDL2 Assets"
                                                           Text="&#xE74D;"
                                                           FontSize="16"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center" />
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>

        <Border Grid.Row="1"
                VerticalAlignment="Bottom"
                BorderBrush="LightGray"
                BorderThickness="0,1,0,0"
                Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}">
            <Grid>
                <!-- Input row when adding -->
                <Border Padding="8,8,8,8"
                        Visibility="{Binding IsAddingNew, Converter={StaticResource BoolToVis}}">
                    <StackPanel Orientation="Horizontal"
                                VerticalAlignment="Center">


                        <TextBox x:Name="NewDescriptionBox"
                                 Width="160"
                                 Margin="34,0,8,0"
                                 Text="{Binding NewDescription, UpdateSourceTrigger=PropertyChanged}" />

                        <StackPanel Width="100"
                                    Orientation="Horizontal"
                                    HorizontalAlignment="Center"
                                    Margin="4,0">
                            <TextBox Text="{Binding NewInterval.Hours, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text=":"
                                       Margin="2,0"
                                       VerticalAlignment="Center" />
                            <TextBox Text="{Binding NewInterval.Minutes, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text=":"
                                       Margin="2,0"
                                       VerticalAlignment="Center" />
                            <TextBox Text="{Binding NewInterval.Seconds, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>

                        <TextBlock Width="85"
                                   Margin="0,0,8,0" />
                        <TextBlock Width="75"
                                   Margin="0,0,8,0" />

                        <StackPanel Orientation="Horizontal"
                                    Width="110"
                                    Margin="8,0,0,0">
                            <Button Content="Save"
                                    Width="45"
                                    Margin="0,0,2,0"
                                    Click="SaveNewButton_Click"
                                    FontSize="11" />

                            <Button Content="Cancel"
                                    Width="50"
                                    Click="CancelNewButton_Click"
                                    FontSize="11" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- "Add" prompt when not adding -->
                <Button Content="+ Add new reminder"
                        Padding="8"
                        HorizontalAlignment="Stretch"
                        Background="Transparent"
                        Foreground="Gray"
                        BorderThickness="0,1,0,0"
                        BorderBrush="LightGray"
                        Cursor="Hand"
                        Click="ShowAddRowButton_Click"
                        Visibility="{Binding IsAddingNew, Converter={StaticResource InvBoolToVis}}" />
            </Grid>
        </Border>

        <!-- Bottom Action Buttons - Bottom Right -->
        <Border Grid.Row="2"
                Padding="8"
                BorderBrush="LightGray"
                BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,8,0,0">
                <Button Content="Delete Selected"
                        Width="120"
                        Height="40"
                        Click="DeleteSelectedButton_Click"
                        Visibility="{Binding HasSelectedItems, Converter={StaticResource BoolToVis}}"
                        Style="{StaticResource RedButton}"
                        Margin="0,0,8,0" />

                <Button Content="+ Add Reminder"
                        Width="120"
                        Height="40"
                        Click="AddReminderButton_Click"
                        Cursor="Hand" />
            </StackPanel>
        </Border>
    </Grid>
</Window>
